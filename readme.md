
LadyPHP - type PHP with elegance
================================

Simple (and stupid) preprocessor for PHP. Main purpose of this is making source code a little more beautiful.

- optional `;` at end of line
- variables doesn't have to be prefixed with `$`, but they must start with a lowercase letter
- indent style, no need for `{` and `}`
- `.` is converted to `->` or `::` (if it's not surrounded by spaces)
- `..` is converted to `.`
- `:` is converted to `=>`, if there isn't space before it
- `fn foo()` is converted to `function foo()`
- `Foo\Bar()` is converted to `new Foo\Bar()`
- optional `:` after `case ...` and `default`
- `<?` and `<?=` are converted to `<?php` and `<?php echo`
- `[` and `]` around arrays are converted to `array()`
- original line numbers are preserved (handy for debugging)
- Lady herself is written in Lady, use the source for reference

## Usage

You can convert all `.lady` files to `.php`.

```php
<?php
require_once __DIR__ . '/lady.php';
Lady::convert(__DIR__);
require_once __DIR__ . '/example.php';
```

Or you can use `lady://` stream wrapper.

```php
<?php
require_once __DIR__ . '/lady.php';
Lady::register(__DIR__ . '/cache');
require_once 'lady://' . __DIR__ . '/example.lady';
```

## Example

```
<?                                                 | <?php /* Generated by LadyPHP */
                                                   |
class Fruit                                        | class Fruit{
  var apples = 0                                   |   var $apples = 0;
  var numbers = [                                  |   var $numbers = array(
    1: 'one',                                      |     1 => 'one',
    2: 'two',                                      |     2 => 'two',
    3: 'three'                                     |     3 => 'three'
  ]                                                |   );
                                                   |
  fn addApples(n = 1)                              |   function addApples($n = 1){
    if (n >= 0)                                    |     if ($n >= 0){
      this.apples += n                             |       $this->apples += $n;}
    return this                                    |     return $this;}
                                                   |
  fn countApples()                                 |   function countApples(){
    apples = this.apples                           |     $apples = $this->apples;
    out = 'You have '                              |     $out = 'You have ';
    out .= isset(this.numbers[apples])             |     $out .= isset($this->numbers[$apples])
           ? this.numbers[apples] : apples         |            ? $this->numbers[$apples] : $apples;
    switch (apples)                                |     switch ($apples){
      case 1                                       |       case 1:
        return out .. ' apple.'                    |         return $out . ' apple.';
      default                                      |       default:
        return "$out apples."                      |         return "$out apples.";}}}
                                                   |
fruit = Fruit()                                    | $fruit = new Fruit();
fruit.addApples(1)                                 | $fruit->addApples(1)
     .addApples(2)                                 |      ->addApples(2);
?>                                                 | ?>
<p><?=fruit.countApples()?></p>                    | <p><?php echo $fruit->countApples()?></p>
```

#### Output

```xml
<p>You have three apples.</p>
```

## API

### Lady::convert()

```php
array Lady::convert(string $dir, bool $recursive = false, bool $expanded = false)
```

Converts changed or new `.lady` files in directory to `.php` files.

Returns array of converted files.

### Lady::register()

```php
bool Lady::register(string $cacheDir = null)
```

Registers `lady://` stream wrapper.

If `$cacheDir` is set, it is used as storage for cache files.

Returns true on success or false on failure.

### Lady::parse()

```php
string Lady::parse(string $source, bool $expanded = false)
```

Converts LadyPHP from string and return PHP code.

### Lady::parseFile()

```php
string Lady::parseFile(string $file, bool $expanded = false)
```

Converts LadyPHP from file and return PHP code.

### Expanded style

If `$expanded` is set to true, closing curly brackets are on new lines and indented.

The output code looks more like written by human, but line numbers are not preserved.

### Usage from command line

```
php lady.php -i <file> [-o <file>] [-e]
php lady.php -c[=<dir>] [-r] [-e]
php lady.php -w[=<dir>] [-r] [-e]

  -i <file>  input file
  -o <file>  output file
  -c <dir>   converts all files in directory
  -w <dir>   watches all files in directory
  -r         recursive search of files
  -e         expanded style
```
